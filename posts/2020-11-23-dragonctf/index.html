<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Dragon CTF 2020 Writeup | Black Bauhinia</title>

<meta name="keywords" content="ctf, dragonctf, crypto" />
<meta name="description" content="Dragon CTF 2020 is definitely had my best CTF moments. There are big brain moments and I have been mind-blown for multiple times during the game. This time we have teamed up with @blackb6a. I have solved all the crypto challenges and two challenges with my teammates.
There are three challenges writeup in this post:
 Bit Flip (parts 2 and 3) Frying in motion babykok  Bit Flip (Crypto, 155&#43;324&#43;343 points) Solved by Mystiz.">
<meta name="author" content="Mystiz, GeoffreyY">
<link rel="canonical" href="https://b6a.black/posts/2020-11-23-dragonctf/" />
<link href="/assets/css/stylesheet.min.79c4dfee3993cd3110886e38d36a5106e0d6922344cefa3ff5c0076f246815f0.css" integrity="sha256-ecTf7jmTzTEQiG4402pRBuDWkiNEzvo/9cAHbyRoFfA=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://b6a.black/favicon.ico">

<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.91.0" />




<script async src="https://www.googletagmanager.com/gtag/js?id=G-M67YZZ2MP1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M67YZZ2MP1');
</script>



<script src="https://kit.fontawesome.com/fbbadced05.js" crossorigin="anonymous"></script>


<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Recursive&display=swap" rel="stylesheet"> 


<meta property="og:title" content="Dragon CTF 2020 Writeup" />
<meta property="og:description" content="Dragon CTF 2020 is definitely had my best CTF moments. There are big brain moments and I have been mind-blown for multiple times during the game. This time we have teamed up with @blackb6a. I have solved all the crypto challenges and two challenges with my teammates.
There are three challenges writeup in this post:
 Bit Flip (parts 2 and 3) Frying in motion babykok  Bit Flip (Crypto, 155&#43;324&#43;343 points) Solved by Mystiz." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://b6a.black/posts/2020-11-23-dragonctf/" />
<meta property="og:image" content="https://b6a.black/images/2020-11-23-dragonctf/map.png" /><meta property="article:published_time" content="2020-11-23T04:33:50+08:00" />
<meta property="article:modified_time" content="2020-11-23T04:33:50+08:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://b6a.black/images/2020-11-23-dragonctf/map.png" />
<meta name="twitter:title" content="Dragon CTF 2020 Writeup"/>
<meta name="twitter:description" content="Dragon CTF 2020 is definitely had my best CTF moments. There are big brain moments and I have been mind-blown for multiple times during the game. This time we have teamed up with @blackb6a. I have solved all the crypto challenges and two challenges with my teammates.
There are three challenges writeup in this post:
 Bit Flip (parts 2 and 3) Frying in motion babykok  Bit Flip (Crypto, 155&#43;324&#43;343 points) Solved by Mystiz."/>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Dragon CTF 2020 Writeup",
  "name": "Dragon CTF 2020 Writeup",
  "description": "Dragon CTF 2020 is definitely had my best CTF moments. There are big brain moments and I have been mind-blown for multiple times during the game. This time we have teamed up with â€¦",
  "keywords": [
    "ctf", "dragonctf", "crypto"
  ],
  "articleBody": "Dragon CTF 2020 is definitely had my best CTF moments. There are big brain moments and I have been mind-blown for multiple times during the game. This time we have teamed up with @blackb6a. I have solved all the crypto challenges and two challenges with my teammates.\nThere are three challenges writeup in this post:\n Bit Flip (parts 2 and 3) Frying in motion babykok  Bit Flip (Crypto, 155+324+343 points) Solved by Mystiz.\nChallenge Summary At the beginning, a 128-bit alice_secret (denoted as $a$) is generated. We are given an oracle that allows us to input a 256-bit value $v$. An PRNG $R$ uses $a\\oplus v$ to derive:\n a 512-bit prime $p$ that is used for Diffie-Hellman, and a 64-bit secret $a$ that is Alice's secret key.  For each oracle call, the following will be printed\n The number of rng.getbits(512) calls for $p$ to be a prime, Bob's public key (which is generated randomly in each call), $B$, The encrypted flag (with AES-CBC \u0026 key is derived from the DH shared key):  Of course, the devil is in the detail. The AES-CBC key is derived as follows:\ndh_shared_key = 1337 ^ pow(B, a, p) key = long_to_bytes(dh_shared_key, 16)[:16] Furthermore, the PRNG is simple. It is maintaining a 256-bit state $s$. 512-bit and 64-bit numbers are generated respectively with:\ndef getbits(bits=512): output = sha256(long_to_bytes(s, 32)).digest() + sha256(long_to_bytes(s+1, 32)).digest() s += 2 return output def getbits(bits=64): output = sha256(long_to_bytes(s, 32)).digest()[-8:] s += 1 return output The plot twist This is the setting for part one. Parts two and three are pretty similar though.\n Parts 2 and 3 are not returning Bob's public key, and Part 3 uses the prime $p$ and check if $q := 2p+1$ is a prime. The prime $q$ (instead of $p$) is used for DH.  Solution Part I: The real bit-flipping Bit Flip 1 was solved in about 45 minutes. Basically we are able to recover $v$ from the number of rng.getbits(512) calls. Since I am sure that there will be writeups on this part available online, I am skipping this part.\nI am just going to admit that I am lazy.  Part II: A nightmare on long_to_bytes Bit Flip 3 was solved in 1 hour - and we were the first to solve. But wait, why isn't part II on Bit Flip 2? The reason is simply because just I cannot solve it (yet).\ndefund had the same question, too.  The prime used for Diffie-Hellman can be 513-bit long. This makes the AES key derivation interesting - as long_to_bytes(x, 16) actually prepend null bytes until the output size is a multiple of 16. For example:\n long_to_bytes(2**127, 16).hex() '80000000000000000000000000000000'  long_to_bytes(2**128, 16).hex() '0000000000000000000000000000000100000000000000000000000000000000' Luckily (or unluckily) the shared key can be as large as 513 bits long. In that case, the first block would be 00 00 ... 00 00 01 - and this is the AES key.\nWe do not even need to know Alice's nor Bob's key. Basically there is around 25% chance for the DH shared key to be 513-bit. When it happens, the constant key is used and we are able to decrypt the flag - DrgnS{C0nst_A3S_K3y_1111111111111!}. First blood ðŸ©¸!\nPart III: Playing mind-games on Bit Flip 2 Bit Flip 2 was solved in about 12 hours. I was mind-blown when I know da wae. Since the DH key could never be 513 bits long anymore, we can no longer exploit in the way as described in Bit Flip 3.\nWait. This made me very puzzled: How do we find the shared key (or $g^{ab}\\ (\\text{mod}\\ p)$) if Bob is not telling us anything?  Basically we have three options:\n Make $a = 0$. This implies that $g^{ab} \\equiv 1$, resulting in a constant key. Find $a$ and $p$ such that $g^a\\in\\mathbb{Z}_p^*$ has a small order. Hence $\\{g^{ab}\\in\\mathbb{Z}_p^*\\ |\\ b\\in\\mathbb{Z}\\}$ can be exhausted feasibly. Make $p$ 385-bit long (or 1-bit, 129-bit or 257-bit). Then we are able to reuse the exploit on Bit Flip 3.  There is a point of time that over 10 teams have solved Bit Flip 2 while only hxp and us have solved Bit Flip 3. If option 3 is the way to go, the number of solves would not be the same. Moreover, option 2 is barely possible in a perspective of math. That said, unless there is a vulnerability that I am not awared of, we may need to make $a = 0$. That is equivalent to rng.getbits(64) == 0 and thus a 64-bit proof-of-work. Possible?\nDuring the research, I was wondering if there is a proof-of-work database that has a list of payloads with many trailing zeros as its hash. I was even wondering if there is someone ever able to solve a 64-bit proof-of-work (particularly on SHA256). Turns out I am too naive - some are able to solve a 76-bit proof-of-work in around 10 minutes. Who? The bitcoin network.\nLet's appreciate the number of zeros...  The block hashing algorithm for Bitcoin is SHA256. This is how block 125552 (the smallest hash as of June 2011) is computed:\nd = bytes.fromhex('0100000081cd02ab7e569e8bcd9317e2fe99f2de44d49ab2b8851ba4a30' + '8000000000000e320b6c2fffc8d750423db8b1eb942ae710e951ed797f7' + 'affc8892b0f1fc122bc7f5d74df2b9441a42a14695') m = hashlib.sha256(d).digest() print(m.hex()) # b9d751533593ac10cdfb7b8e03cad8babc67d8eaeac0a3699b82857dacac9390 h = hashlib.sha256(m).digest() print(h.hex()) # 1dbd981fe6985776b644b173a4d0385ddc1aa2a829688d1e0000000000000000 The above hash ends with 8 null bytes. If the below seed generates a prime in its first call of rng.getbits(512), then a = 0:\nseed = 0xb9d751533593ac10cdfb7b8e03cad8babc67d8eaeac0a3699b82857dacac938c.\nUnfortunately it is not. Luckily there are many inputs (available on the Bitcoin network) that generates eight trailing null bytes as its hash. We can simply look at the blocks and find the one we need. For me, I was using the block API from blockcypher.com to retrieve and compute the preimage of hashes. Eventually block 657972 satisfies our needs and the Alice's secret key will be $a = 0$.\nThat said, the AES key would be 00 00 ... 00 05 38 when $a = 0$ - and we are able to decrypt the flag: DrgnS{B1tc0in_p0w3r_crypt0_brut3}! :tada:\nFrying in motion (Crypto, 324 points) Solved by Mystiz.\nChallenge Summary The challenge is simple. Upon connecting to the challenge server,\n 257 HEX characters are generated, strfry-ed for 0x140000 times. Nothing is returned. (This took around 5 seconds) Players are allowed to send up to 4096 bytes. The server returns the strfry-ed input. 64 HEX characters (denote as fry_buf) strfry-ed and returned. The player is expected to find fry_buf.  More importantly, the challenge server has a timeout of 20 seconds. Hence, you have to compute from the strfry-ed response in 15 seconds.\nSolution Part I: The first encounter  \"WTF. Yet another strfry question? It must be very boring.\" ~ Mystiz\n This is the first comment I made to the challenge. It is actually much interesting than I thought and I have spent a good 5 hours for the challenge.\nThe previous CTFs (for example, challenge from Ã¥ngstromCTF 2020 and DawgCTF 2020) exploited on the small seed space that can be exhausted. In the previous versions of libc, the seeds for strfry is given by time(NULL) ^ getpid(). I was trying to print time(NULL) and getpid() alongside with the strfry result, but the seed does not check out. What? Maybe the world is not peaceful anymore in libc 2.31-0ubuntu9. Let's download the source code and have a read.\nPart II: Code-reading game Let's verify the first point - is the implementation for strfry changed?\n// string/strfry.c  char * strfry (char *string) { // omitted...  if (!init) { static char state[32]; rdata.state = NULL; __initstate_r (random_bits (), state, sizeof (state), \u0026rdata); init = 1; } // omitted... }// include/random-bits.h  static inline uint32_t random_bits (void) { struct timespec tv; __clock_gettime (CLOCK_MONOTONIC, \u0026tv); /* Shuffle the lower bits to minimize the clock bias. */ uint32_t ret = tv.tv_nsec ^ tv.tv_sec; ret ^= (ret  24) | (ret  8); return ret; } Although the string is fried in the same way, the seed is changed! Since the seed is 32 bits long, maybe I can just exhaust it. However it takes 5 seconds to strfry a 257-byte long string for 0x140000 times, it is not feasible to brute force with the challenge implementation. Let's read how random numbers are generated.\n// stdlib/random_r.c  int __initstate_r (unsigned int seed, char *arg_state, size_t n, struct random_data *buf) { // omitted...  int type; if (n = BREAK_3) type = n  BREAK_4 ? TYPE_3 : TYPE_4; else if (n  BREAK_1) { if (n  BREAK_0) goto fail; type = TYPE_0; } else type = n  BREAK_2 ? TYPE_1 : TYPE_2; int degree = random_poly_info.degrees[type]; int separation = random_poly_info.seps[type]; buf-rand_type = type; buf-rand_sep = separation; buf-rand_deg = degree; int32_t *state = \u0026((int32_t *) arg_state)[1];\t/* First location. */ /* Must set END_PTR before srandom. */ buf-end_ptr = \u0026state[degree]; buf-state = state; __srandom_r (seed, buf); state[-1] = TYPE_0; if (type != TYPE_0) state[-1] = (buf-rptr - state) * MAX_TYPES + type; // omitted... } strfry uses a 32-byte state, which indicates that TYPE_1 PRNG is used. Seven 32-bit unsigned integer is derived from the seed (denote it as s[0], s[1], ..., s[6]) and set the counter c := 0. This is the equivalent Python code.\nclass GlibcRandom: def __init__(self, seed): self.init_state(seed) [self.next() for _ in range(70)] def init_state(self, seed): state = [seed] for i in range(1, 7): h, l = seed // 127773, seed % 127773 seed = (16807 * l - 2836 * h) \u0026 0x7fffffff state.append(seed) self.state = [ state, 0 ] def next(self): s, t = self.state v = (s[(t+3) % 7] + s[t % 7]) \u0026 0xffffffff v = 1 s[(t+3) % 7] += s[t % 7] s[(t+3) % 7] \u0026= 0xffffffff self.state = [s, (t + 1) % 7] return v Part III: Fast-forwarding the states Fast-forwarding the PRNG is easy. This is similar on the Team Trees challenge in CONFidence CTF this year. We can skip states with the matrix implementation (and I am able to skip the details for this part, too). After all, 5M seeds can be checked per second. Since we have only 15 seconds to recover the seed, we are unable to find the entire search space (only 1.75% of the seed space is checked). In average, we can recover the seed from the strfry output in 15 seconds once every 60 times. Finally, if we are able to recover the seed, we can freely fry and unfry strings.\nAfter two hours, we have the flag: DrgnS{Fr13d_57r1Ng5_4r3_tH3_Be5t_s7r1NgS!}.\nbabykok (Misc, 215 points) Solved by GeoffreyY.\nWe simply have to solve some theorems using Coq.\nGood thing I have written some lean before, so learning / writing Coq isn't that difficult.\nFor the first part we have to solve the following 6 theorems in some random order.\nI'd like to thank my teammate @ozetta for finding this powerful coq tactic intuition, and @harrier_lcc for showing us his coq and how to use it.\nThis wouldâ€™ve taken a lot longer if we didnâ€™t watch him livestreaming playing around with his coq. His coq is very very nah thatâ€™s it Iâ€™m done with the jokes.  Theorem problem0: forall A B : Prop, A \\/ B - B \\/ A.  intuition.Theorem problem1: forall A B C D : Prop, (A - B) /\\ (C - D) /\\ A /\\ C - B /\\ D.  intuition.Theorem problem2: forall A B : Type, ((((A - B) - A) - A) - B) - B.  intuition. We actually have to do some work with the remaining 3 starter problems:\nTheorem problem3: forall b1 b2 : bool, negb (b1 \u0026\u0026 b2) = (negb b1 || negb b2)%bool.  intros.  1 subgoal (ID 10) b1, b2 : bool ============================ negb (b1 \u0026\u0026 b2) = (negb b1 || negb b2)%bool The general idea for all of these proofs is to apply induction to split the proof into smaller, simple cases.\n induction b1.  2 subgoals (ID 14) b2 : bool ============================ negb (true \u0026\u0026 b2) = (negb true || negb b2)%bool subgoal 2 (ID 15) is: negb (false \u0026\u0026 b2) = (negb false || negb b2)%bool  auto.  ...  auto.Theorem problem4: forall (C : Prop) (T : Set) (B : T - Prop), (exists x : T, C - B x) - C - exists x : T, B x.  intros.  1 subgoal (ID 23) C : Prop T : Set B : T - Prop H : exists x : T, C - B x H0 : C ============================ exists x : T, B x  induction H.  1 subgoal (ID 30) C : Prop T : Set B : T - Prop x : T H : C - B x H0 : C ============================ exists x0 : T, B x0  apply H in H0.  1 subgoal (ID 31) C : Prop T : Set B : T - Prop x : T H : C - B x H0 : B x ============================ exists x0 : T, B x0  exists x.  1 subgoal (ID 34) C : Prop T : Set B : T - Prop x : T H : C - B x H0 : B x ============================ B x  assumption. Instead of explicitly using apply H in H0., I've now discovered that the following simpler proof also works:\nintros. induction H. exists x. auto. We have to deal with natural numbers for the final starter problem, which we can also solve using induction:\nTheorem problem5: forall m n : nat, m + n = n + m.  intros.  ...  induction m.  2 subgoals (ID 14) n : nat ============================ 0 + n = n + 0 subgoal 2 (ID 18) is: S m + n = n + S m  auto.  1 subgoal (ID 18) m, n : nat IHm : m + n = n + m ============================ S m + n = n + S m  simpl.  1 subgoal (ID 21) m, n : nat IHm : m + n = n + m ============================ S (m + n) = n + S m  rewrite IHm.  1 subgoal (ID 22) m, n : nat IHm : m + n = n + m ============================ S (n + m) = n + S m  auto. There are only 2 more problems after the starter 6.\nnice warmup, lets do some math! Require Import Arith.Mult. Theorem math_problem: forall m n, (n + m) * (n + m) = n * n + 2 * n * m + m * m. The idea with this one is simply to expand both sides, and let the theorem prover see that both sides have the same terms.\n intros.  ...  simpl.  1 subgoal (ID 13) m, n : nat ============================ (n + m) * (n + m) = n * n + (n + (n + 0)) * m + m * m  rewrite mult_plus_distr_r.  ...  rewrite mult_plus_distr_r.  1 subgoal (ID 15) m, n : nat ============================ n * (n + m) + m * (n + m) = n * n + (n * m + (n + 0) * m) + m * m  rewrite mult_plus_distr_l.  ...  rewrite mult_plus_distr_l.  1 subgoal (ID 17) m, n : nat ============================ n * n + n * m + (m * n + m * m) = n * n + (n * m + (n + 0) * m) + m * m  rewrite plus_assoc.  ...  rewrite plus_assoc.  1 subgoal (ID 19) m, n : nat ============================ n * n + n * m + m * n + m * m = n * n + n * m + (n + 0) * m + m * m  rewrite plus_0_r.  1 subgoal (ID 20) m, n : nat ============================ n * n + n * m + m * n + m * m = n * n + n * m + n * m + m * m  firstorder. firstorder didn't work on my machine but worked on the server Â¯\\_(ãƒ„)_/Â¯\nThe final question took us a while:\ngj, now something more interesting, can you prove my code works? Require Import Le. Section last_stage. Variable A : Type. Inductive list : Type := | nil : list | cons : A - list - list. Fixpoint nth (l : list) (n : nat) : option A := match n,l with | 0, cons x xs = Some x | S n, cons _ xs = nth xs n | _, _ = None end. Fixpoint length (l:list) : nat := match l with | nil = 0 | cons _ xs = 1 + length xs end. Theorem nth_in: forall (n:nat) (l:list), n  length l - exists a: A, nth l n = Some a. The idea for this is induction on both n and l. It should be easy for the base cases of n is 0, or l is nil, and induction completes the rest of the proof.\n intros.  ...  revert H.  ...  revert n.  1 subgoal (ID 15) A : Type l : list ============================ forall n : nat, n  length l - exists a : A, nth l n = Some a  induction l.  2 subgoals (ID 19) A : Type ============================ forall n : nat, n  length nil - exists a : A, nth nil n = Some a subgoal 2 (ID 23) is: forall n : nat, n  length (cons a l) - exists a0 : A, nth (cons a l) n = Some a0  inversion 1.  1 subgoal (ID 23) A : Type a : A l : list IHl : forall n : nat, n  length l - exists a : A, nth l n = Some a ============================ forall n : nat, n  length (cons a l) - exists a0 : A, nth (cons a l) n = Some a0  induction n.  2 subgoals (ID 50) A : Type a : A l : list IHl : forall n : nat, n  length l - exists a : A, nth l n = Some a ============================ 0  length (cons a l) - exists a0 : A, nth (cons a l) 0 = Some a0 subgoal 2 (ID 53) is: S n  length (cons a l) - exists a0 : A, nth (cons a l) (S n) = Some a0  simpl.  2 subgoals (ID 84) ... 0  S (length l) - exists a0 : A, Some a = Some a0 ...  intro.  2 subgoals (ID 60) ... exists a0 : A, Some a = Some a0 ...  exists a.  ...  auto.  1 subgoal (ID 53) A : Type a : A l : list IHl : forall n : nat, n  length l - exists a : A, nth l n = Some a n : nat IHn : n  length (cons a l) - exists a0 : A, nth (cons a l) n = Some a0 ============================ S n  length (cons a l) - exists a0 : A, nth (cons a l) (S n) = Some a0  simpl.  1 subgoal (ID 68) A : Type a : A l : list IHl : forall n : nat, n  length l - exists a : A, nth l n = Some a n : nat IHn : n  length (cons a l) - exists a0 : A, nth (cons a l) n = Some a0 ============================ S n  S (length l) - exists a0 : A, nth l n = Some a0  auto with arith. Finally we have the flag:\ngj flag: DrgnS{xxxx_my_c0q_for_4_flag_17bcbc34b7c565a766e335}\n",
  "wordCount" : "3320",
  "inLanguage": "en",
  "image":"https://b6a.black/images/2020-11-23-dragonctf/map.png","datePublished": "2020-11-23T04:33:50+08:00",
  "dateModified": "2020-11-23T04:33:50+08:00",
  "author":[{
    "@type": "Person",
    "name": "Mystiz"
  }, {
    "@type": "Person",
    "name": "GeoffreyY"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://b6a.black/posts/2020-11-23-dragonctf/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Black Bauhinia",
    "logo": {
      "@type": "ImageObject",
      "url": "https://b6a.black/favicon.ico"
    }
  }
}
</script>



</head>

<body class=" dark" id="top">
<noscript>
    <style type="text/css">
        .theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://b6a.black/" accesskey="h" title="Black Bauhinia (Alt + H)">Black Bauhinia</a>
            <span class="logo-switches">
                
                
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://b6a.black/about-us/" title="About Us">
                    <span>About Us</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">

    <h1 class="post-title">
      Dragon CTF 2020 Writeup
    </h1>
    <div class="post-meta">

November 23, 2020&nbsp;Â·&nbsp;Mystiz, GeoffreyY

</div>
  </header>
  
  
  <div class="post-content js-toc-content">
<p><em>Dragon CTF 2020</em> is definitely had my best CTF moments. There are big brain moments and I have been mind-blown for multiple times during the game. This time we have teamed up with @blackb6a. I have solved all the crypto challenges and two challenges with my teammates.</p>

<p>There are three challenges writeup in this post:</p>

<ul>
<li>Bit Flip (parts 2 and 3)</li>
<li>Frying in motion</li>
<li>babykok</li>
</ul>

<h2 id="bit-flip-crypto-155324343-points">Bit Flip (Crypto, 155+324+343 points)<a hidden class="anchor" aria-hidden="true" href="#bit-flip-crypto-155324343-points">#</a></h2>

<p>Solved by <em>Mystiz</em>.</p>

<h3 id="challenge-summary">Challenge Summary<a hidden class="anchor" aria-hidden="true" href="#challenge-summary">#</a></h3>

<p>At the beginning, a 128-bit <code>alice_secret</code> (denoted as $a$) is generated. We are given an oracle that allows us to input a 256-bit value $v$. An PRNG $R$ uses $a\oplus v$ to derive:</p>

<ol>
<li>a 512-bit prime $p$ that is used for Diffie-Hellman, and</li>
<li>a 64-bit secret $a$ that is Alice's secret key.</li>
</ol>

<p>For each oracle call, the following will be printed</p>

<ol>
<li>The number of <code>rng.getbits(512)</code> calls for $p$ to be a prime,</li>
<li>Bob's public key (which is generated randomly in each call), $B$,</li>
<li>The encrypted flag (with AES-CBC &amp; key is derived from the DH shared key):</li>
</ol>

<p>Of course, <em>the devil is in the detail</em>. The AES-CBC <code>key</code> is derived as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dh_shared_key <span style="color:#f92672">=</span> <span style="color:#ae81ff">1337</span> <span style="color:#f92672">^</span> pow(B, a, p)
key <span style="color:#f92672">=</span> long_to_bytes(dh_shared_key, <span style="color:#ae81ff">16</span>)[:<span style="color:#ae81ff">16</span>]</code></pre></div>
<p>Furthermore, the PRNG is simple. It is maintaining a 256-bit state $s$. 512-bit and 64-bit numbers are generated respectively with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getbits</span>(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">512</span>):
    output <span style="color:#f92672">=</span> sha256(long_to_bytes(s, <span style="color:#ae81ff">32</span>))<span style="color:#f92672">.</span>digest() <span style="color:#f92672">+</span> sha256(long_to_bytes(s<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">32</span>))<span style="color:#f92672">.</span>digest()
    s <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>
    <span style="color:#66d9ef">return</span> output

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getbits</span>(bits<span style="color:#f92672">=</span><span style="color:#ae81ff">64</span>):
    output <span style="color:#f92672">=</span> sha256(long_to_bytes(s, <span style="color:#ae81ff">32</span>))<span style="color:#f92672">.</span>digest()[<span style="color:#f92672">-</span><span style="color:#ae81ff">8</span>:]
    s <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">return</span> output</code></pre></div>
<h4 id="the-plot-twist">The plot twist<a hidden class="anchor" aria-hidden="true" href="#the-plot-twist">#</a></h4>

<p>This is the setting for part one. Parts two and three are pretty similar though.</p>

<ul>
<li>Parts 2 and 3 are <em>not</em> returning Bob's public key, and</li>
<li>Part 3 uses the prime $p$ and check if $q := 2p+1$ is a prime. The prime $q$ (instead of $p$) is used for DH.</li>
</ul>

<h3 id="solution">Solution<a hidden class="anchor" aria-hidden="true" href="#solution">#</a></h3>

<h4 id="part-i-the-real-bitflipping">Part I: The real bit-flipping<a hidden class="anchor" aria-hidden="true" href="#part-i-the-real-bitflipping">#</a></h4>

<p><em>Bit Flip 1</em> was solved in about 45 minutes. Basically we are able to recover $v$ from the number of <code>rng.getbits(512)</code> calls. Since I am sure that there will be writeups on this part available online, I am skipping this part.</p>

<div class="alert warning">
  I am just going to admit that I am lazy.
</div>
  

<h4 id="part-ii-a-nightmare-on-longtobytes">Part II: A nightmare on <code>long_to_bytes</code><a hidden class="anchor" aria-hidden="true" href="#part-ii-a-nightmare-on-longtobytes">#</a></h4>

<p><em>Bit Flip 3</em> was solved in 1 hour - and we were the first to solve. But wait, why isn't part II on <em>Bit Flip 2</em>? The reason is simply because just I cannot solve it (yet).</p>


  <figure class="center" >
    <img src="/images/2020-11-23-dragonctf/bit-flip-01.png"   />
    
      <figcaption class="right" >defund had the same question, too.</figcaption>
    
  </figure>



<p>The prime used for Diffie-Hellman can be 513-bit long. This makes the AES key derivation interesting - as <code>long_to_bytes(x, 16)</code> actually prepend null bytes until the output size is a multiple of 16. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> long_to_bytes(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">127</span>, <span style="color:#ae81ff">16</span>)<span style="color:#f92672">.</span>hex()
<span style="color:#e6db74">&#39;80000000000000000000000000000000&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> long_to_bytes(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">16</span>)<span style="color:#f92672">.</span>hex()
<span style="color:#e6db74">&#39;0000000000000000000000000000000100000000000000000000000000000000&#39;</span></code></pre></div>
<p>Luckily (or unluckily) the shared key can be as large as 513 bits long. In that case, the first block would be <code>00 00 ... 00 00 01</code> - and this is the AES key.</p>

<p>We do not even need to know Alice's nor Bob's key. Basically there is around 25% chance for the DH shared key to be 513-bit. When it happens, the constant key is used and we are able to decrypt the flag - <code>DrgnS{C0nst_A3S_K3y_1111111111111!}</code>. First blood ðŸ©¸!</p>

<h4 id="part-iii-playing-mindgames-on-bit-flip-2">Part III: Playing mind-games on <em>Bit Flip 2</em><a hidden class="anchor" aria-hidden="true" href="#part-iii-playing-mindgames-on-bit-flip-2">#</a></h4>

<p><em>Bit Flip 2</em> was solved in about 12 hours. I was mind-blown when I know <em>da wae</em>. Since the DH key could never be 513 bits long anymore, we can no longer exploit in the way as described in <em>Bit Flip 3</em>.</p>

<div class="alert warning">
  <strong>Wait.</strong> This made me <em>very</em> puzzled: How do we find the shared key (or $g^{ab}\ (\text{mod}\ p)$) if Bob is not telling us anything?
</div>
  

<p>Basically we have three options:</p>

<ol>
<li>Make $a = 0$. This implies that $g^{ab} \equiv 1$, resulting in a constant key.</li>
<li>Find $a$ and $p$ such that $g^a\in\mathbb{Z}_p^*$ has a small order. Hence $\{g^{ab}\in\mathbb{Z}_p^*\ |\ b\in\mathbb{Z}\}$ can be exhausted feasibly.</li>
<li>Make $p$ 385-bit long (or 1-bit, 129-bit or 257-bit). Then we are able to reuse the exploit on <em>Bit Flip 3</em>.</li>
</ol>

<p>There is a point of time that over 10 teams have solved <em>Bit Flip 2</em> while only <em>hxp</em> and us have solved <em>Bit Flip 3</em>. If option 3 is the way to go, the number of solves would not be the same. Moreover, option 2 is barely possible in a perspective of math. That said, unless there is a vulnerability that I am not awared of, we may need to make $a = 0$. That is equivalent to <code>rng.getbits(64) == 0</code> and thus a 64-bit proof-of-work. Possible?</p>

<p>During the research, I was wondering if there is a proof-of-work database that has a list of payloads with many trailing zeros as its hash. I was even wondering if there is someone ever able to solve a 64-bit proof-of-work (particularly on SHA256). Turns out I am too naive - <em>some</em> are able to solve a 76-bit proof-of-work in around 10 minutes. Who? The bitcoin network.</p>


  <figure class="center" >
    <img src="/images/2020-11-23-dragonctf/bit-flip-02.png"   />
    
      <figcaption class="right" >Let's appreciate the number of zeros...</figcaption>
    
  </figure>



<p>The <a href="https://en.bitcoin.it/wiki/Block_hashing_algorithm">block hashing algorithm</a> for Bitcoin is SHA256. This is how block 125552 (the smallest hash as of June 2011) is computed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">d <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(<span style="color:#e6db74">&#39;0100000081cd02ab7e569e8bcd9317e2fe99f2de44d49ab2b8851ba4a30&#39;</span> <span style="color:#f92672">+</span>
                  <span style="color:#e6db74">&#39;8000000000000e320b6c2fffc8d750423db8b1eb942ae710e951ed797f7&#39;</span> <span style="color:#f92672">+</span>
                  <span style="color:#e6db74">&#39;affc8892b0f1fc122bc7f5d74df2b9441a42a14695&#39;</span>)
m <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(d)<span style="color:#f92672">.</span>digest()
print(m<span style="color:#f92672">.</span>hex())
<span style="color:#75715e"># b9d751533593ac10cdfb7b8e03cad8babc67d8eaeac0a3699b82857dacac9390</span>
h <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha256(m)<span style="color:#f92672">.</span>digest()
print(h<span style="color:#f92672">.</span>hex())
<span style="color:#75715e"># 1dbd981fe6985776b644b173a4d0385ddc1aa2a829688d1e0000000000000000</span></code></pre></div>
<p>The above hash ends with 8 null bytes. If the below seed generates a prime in its first call of <code>rng.getbits(512)</code>, then <code>a = 0</code>:</p>

<p><code>seed = 0xb9d751533593ac10cdfb7b8e03cad8babc67d8eaeac0a3699b82857dacac938c</code>.</p>

<p>Unfortunately it is not. Luckily there are many inputs (available on the Bitcoin network) that generates eight trailing null bytes as its hash. We can simply look at the blocks and find the one we need. For me, I was using the block API from <em>blockcypher.com</em> to retrieve and compute the preimage of hashes. Eventually <a href="https://live.blockcypher.com/btc/block/657972">block 657972</a> satisfies our needs and the Alice's secret key will be $a = 0$.</p>

<p>That said, the AES key would be <code>00 00 ... 00 05 38</code> when $a = 0$ - and we are able to decrypt the flag: <code>DrgnS{B1tc0in_p0w3r_crypt0_brut3}</code>! :tada:</p>

<h2 id="frying-in-motion-crypto-324-points">Frying in motion (Crypto, 324 points)<a hidden class="anchor" aria-hidden="true" href="#frying-in-motion-crypto-324-points">#</a></h2>

<p>Solved by <em>Mystiz</em>.</p>

<h3 id="challenge-summary-1">Challenge Summary<a hidden class="anchor" aria-hidden="true" href="#challenge-summary-1">#</a></h3>

<p>The challenge is simple. Upon connecting to the challenge server,</p>

<ul>
<li>257 HEX characters are generated, <code>strfry</code>-ed for <code>0x140000</code> times. Nothing is returned. (<em>This took around 5 seconds</em>)</li>
<li>Players are allowed to send up to 4096 bytes. The server returns the <code>strfry</code>-ed input.</li>
<li>64 HEX characters (denote as <code>fry_buf</code>) <code>strfry</code>-ed and returned.</li>
<li>The player is expected to find <code>fry_buf</code>.</li>
</ul>

<p>More importantly, the challenge server has a timeout of 20 seconds. Hence, you have to compute from the <code>strfry</code>-ed response in 15 seconds.</p>

<h3 id="solution-1">Solution<a hidden class="anchor" aria-hidden="true" href="#solution-1">#</a></h3>

<h4 id="part-i-the-first-encounter">Part I: The first encounter<a hidden class="anchor" aria-hidden="true" href="#part-i-the-first-encounter">#</a></h4>

<blockquote>
<p>&quot;WTF. Yet another <code>strfry</code> question? It must be very boring.&quot; ~ <em>Mystiz</em></p>
</blockquote>

<p>This is the first comment I made to the challenge. It is actually much interesting than I thought and I have spent a good 5 hours for the challenge.</p>

<p>The previous CTFs (for example, challenge from <a href="https://ctftime.org/task/10764">Ã¥ngstromCTF 2020</a> and <a href="https://ctftime.org/task/11259">DawgCTF 2020</a>) exploited on the small seed space that can be exhausted. In the previous versions of libc, the seeds for <code>strfry</code> is given by <code>time(NULL) ^ getpid()</code>. I was trying to print <code>time(NULL)</code> and <code>getpid()</code> alongside with the  <code>strfry</code> result, but the seed does not check out. What? Maybe the world is not peaceful anymore in <em>libc 2.31-0ubuntu9</em>. Let's download the source code and have a read.</p>

<h4 id="part-ii-codereading-game">Part II: Code-reading game<a hidden class="anchor" aria-hidden="true" href="#part-ii-codereading-game">#</a></h4>

<p>Let's verify the first point - is the implementation for <code>strfry</code> changed?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">// string/strfry.c
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>
<span style="color:#a6e22e">strfry</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>string)
{
  <span style="color:#75715e">// omitted...
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>init)
    {
      <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> state[<span style="color:#ae81ff">32</span>];
      rdata.state <span style="color:#f92672">=</span> NULL;
      __initstate_r (random_bits (),
		     state, <span style="color:#66d9ef">sizeof</span> (state), <span style="color:#f92672">&amp;</span>rdata);
      init <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
    }
  <span style="color:#75715e">// omitted...
</span><span style="color:#75715e"></span>}</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">// include/random-bits.h
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">uint32_t</span>
<span style="color:#a6e22e">random_bits</span> (<span style="color:#66d9ef">void</span>)
{
  <span style="color:#66d9ef">struct</span> timespec tv;
  __clock_gettime (CLOCK_MONOTONIC, <span style="color:#f92672">&amp;</span>tv);
  <span style="color:#75715e">/* Shuffle the lower bits to minimize the clock bias.  */</span>
  <span style="color:#66d9ef">uint32_t</span> ret <span style="color:#f92672">=</span> tv.tv_nsec <span style="color:#f92672">^</span> tv.tv_sec;
  ret <span style="color:#f92672">^=</span> (ret <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">24</span>) <span style="color:#f92672">|</span> (ret <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>);
  <span style="color:#66d9ef">return</span> ret;
}</code></pre></div>
<p>Although the string is fried in the same way, the seed is changed! Since the seed is 32 bits long, maybe I can just exhaust it. However it takes 5 seconds to <code>strfry</code> a 257-byte long string for 0x140000 times, it is not feasible to brute force with the challenge implementation. Let's read how random numbers are generated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">// stdlib/random_r.c
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">__initstate_r</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> seed, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>arg_state, size_t n,
	       <span style="color:#66d9ef">struct</span> random_data <span style="color:#f92672">*</span>buf)
{
  <span style="color:#75715e">// omitted...
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> type;
  <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">&gt;=</span> BREAK_3)
    type <span style="color:#f92672">=</span> n <span style="color:#f92672">&lt;</span> BREAK_4 <span style="color:#f92672">?</span> TYPE_3 : TYPE_4;
  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">&lt;</span> BREAK_1)
    {
      <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">&lt;</span> BREAK_0)
	<span style="color:#66d9ef">goto</span> fail;

      type <span style="color:#f92672">=</span> TYPE_0;
    }
  <span style="color:#66d9ef">else</span>
    type <span style="color:#f92672">=</span> n <span style="color:#f92672">&lt;</span> BREAK_2 <span style="color:#f92672">?</span> TYPE_1 : TYPE_2;

  <span style="color:#66d9ef">int</span> degree <span style="color:#f92672">=</span> random_poly_info.degrees[type];
  <span style="color:#66d9ef">int</span> separation <span style="color:#f92672">=</span> random_poly_info.seps[type];

  buf<span style="color:#f92672">-&gt;</span>rand_type <span style="color:#f92672">=</span> type;
  buf<span style="color:#f92672">-&gt;</span>rand_sep <span style="color:#f92672">=</span> separation;
  buf<span style="color:#f92672">-&gt;</span>rand_deg <span style="color:#f92672">=</span> degree;
  <span style="color:#66d9ef">int32_t</span> <span style="color:#f92672">*</span>state <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>((<span style="color:#66d9ef">int32_t</span> <span style="color:#f92672">*</span>) arg_state)[<span style="color:#ae81ff">1</span>];	<span style="color:#75715e">/* First location.  */</span>
  <span style="color:#75715e">/* Must set END_PTR before srandom.  */</span>
  buf<span style="color:#f92672">-&gt;</span>end_ptr <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>state[degree];

  buf<span style="color:#f92672">-&gt;</span>state <span style="color:#f92672">=</span> state;

  __srandom_r (seed, buf);

  state[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> TYPE_0;
  <span style="color:#66d9ef">if</span> (type <span style="color:#f92672">!=</span> TYPE_0)
    state[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (buf<span style="color:#f92672">-&gt;</span>rptr <span style="color:#f92672">-</span> state) <span style="color:#f92672">*</span> MAX_TYPES <span style="color:#f92672">+</span> type;
  <span style="color:#75715e">// omitted...
</span><span style="color:#75715e"></span>}</code></pre></div>
<p><code>strfry</code> uses a 32-byte state, which indicates that <code>TYPE_1</code> PRNG is used. Seven 32-bit unsigned integer is derived from the seed (denote it as <code>s[0]</code>, <code>s[1]</code>, ..., <code>s[6]</code>) and set the counter <code>c := 0</code>. This is the equivalent Python code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GlibcRandom</span>:
    <span style="color:#66d9ef">def</span> __init__(self, seed):
        self<span style="color:#f92672">.</span>init_state(seed)
        [self<span style="color:#f92672">.</span>next() <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">70</span>)]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init_state</span>(self, seed):
        state <span style="color:#f92672">=</span> [seed]
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">7</span>):
            h, l <span style="color:#f92672">=</span> seed <span style="color:#f92672">//</span> <span style="color:#ae81ff">127773</span>, seed <span style="color:#f92672">%</span> <span style="color:#ae81ff">127773</span>

            seed <span style="color:#f92672">=</span> (<span style="color:#ae81ff">16807</span> <span style="color:#f92672">*</span> l <span style="color:#f92672">-</span> <span style="color:#ae81ff">2836</span> <span style="color:#f92672">*</span> h) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0x7fffffff</span>
            state<span style="color:#f92672">.</span>append(seed)
        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> [
            state,
            <span style="color:#ae81ff">0</span>
        ]
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">next</span>(self):
        s, t <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>state
        v <span style="color:#f92672">=</span> (s[(t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">7</span>] <span style="color:#f92672">+</span> s[t <span style="color:#f92672">%</span> <span style="color:#ae81ff">7</span>]) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xffffffff</span>
        v <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>

        s[(t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">7</span>] <span style="color:#f92672">+=</span> s[t <span style="color:#f92672">%</span> <span style="color:#ae81ff">7</span>]
        s[(t<span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">7</span>] <span style="color:#f92672">&amp;=</span> <span style="color:#ae81ff">0xffffffff</span>

        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span> [s, (t <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">7</span>]
        <span style="color:#66d9ef">return</span> v</code></pre></div>
<h4 id="part-iii-fastforwarding-the-states">Part III: Fast-forwarding the states<a hidden class="anchor" aria-hidden="true" href="#part-iii-fastforwarding-the-states">#</a></h4>

<p>Fast-forwarding the PRNG is easy. This is similar on the <a href="/posts/2020-09-08-confidencectf-team-trees/#42-fast-sequence-generation">Team Trees</a> challenge in CONFidence CTF this year. We can skip states with the matrix implementation (and I am able to skip the details for this part, too). After all, 5M seeds can be checked per second. Since we have only 15 seconds to recover the seed, we are unable to find the entire search space (only 1.75% of the seed space is checked). In average, we can recover the seed from the <code>strfry</code> output in 15 seconds once every 60 times. Finally, if we are able to recover the seed, we can freely fry and unfry strings.</p>

<p>After two hours, we have the flag: <code>DrgnS{Fr13d_57r1Ng5_4r3_tH3_Be5t_s7r1NgS!}</code>.</p>

<h2 id="babykok-misc-215-points">babykok (Misc, 215 points)<a hidden class="anchor" aria-hidden="true" href="#babykok-misc-215-points">#</a></h2>

<p>Solved by <em>GeoffreyY</em>.</p>

<p>We simply have to solve some theorems using <a href="https://coq.inria.fr/">Coq</a>.</p>

<p>Good thing I have written some <a href="https://leanprover.github.io/">lean</a> before, so learning / writing Coq isn't that difficult.</p>

<p>For the first part we have to solve the following 6 theorems in some random order.</p>

<p>I'd like to thank my teammate @ozetta for finding this powerful coq tactic <code>intuition</code>, and @harrier_lcc for showing us his coq and how to use it.</p>

<div class="alert info">
  This would&rsquo;ve taken a lot longer if we didn&rsquo;t watch him livestreaming playing around with his coq.
His coq is very very nah that&rsquo;s it I&rsquo;m done with the jokes.
</div>
  
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">Theorem</span> problem0<span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> A B <span style="color:#f92672">:</span> <span style="color:#66d9ef">Prop</span><span style="color:#f92672">,</span> A <span style="color:#f92672">\/</span> B <span style="color:#f92672">-&gt;</span> B <span style="color:#f92672">\/</span> A<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intuition</span><span style="color:#f92672">.</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">Theorem</span> problem1<span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> A B C D <span style="color:#f92672">:</span> <span style="color:#66d9ef">Prop</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>A <span style="color:#f92672">-&gt;</span> B<span style="color:#f92672">)</span> <span style="color:#f92672">/\</span> <span style="color:#f92672">(</span>C <span style="color:#f92672">-&gt;</span> D<span style="color:#f92672">)</span> <span style="color:#f92672">/\</span> A <span style="color:#f92672">/\</span> C <span style="color:#f92672">-&gt;</span> B <span style="color:#f92672">/\</span> D<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intuition</span><span style="color:#f92672">.</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">Theorem</span> problem2<span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> A B <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span><span style="color:#f92672">,</span> <span style="color:#f92672">((((</span>A <span style="color:#f92672">-&gt;</span> B<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> A<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> A<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> B<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> B<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intuition</span><span style="color:#f92672">.</span></code></pre></div>
<p>We actually have to do some work with the remaining 3 starter problems:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">Theorem</span> problem3<span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> b1 b2 <span style="color:#f92672">:</span> <span style="color:#66d9ef">bool</span><span style="color:#f92672">,</span> negb <span style="color:#f92672">(</span>b1 <span style="color:#f92672">&amp;&amp;</span> b2<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>negb b1 <span style="color:#f92672">||</span> negb b2<span style="color:#f92672">)%</span><span style="color:#66d9ef">bool</span><span style="color:#f92672">.</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intros</span><span style="color:#f92672">.</span>

<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 10<span style="color:#f92672">)</span>

  b1<span style="color:#f92672">,</span> b2 <span style="color:#f92672">:</span> <span style="color:#66d9ef">bool</span>
  <span style="color:#f92672">============================</span>
  negb <span style="color:#f92672">(</span>b1 <span style="color:#f92672">&amp;&amp;</span> b2<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>negb b1 <span style="color:#f92672">||</span> negb b2<span style="color:#f92672">)%</span><span style="color:#66d9ef">bool</span></code></pre></div>
<p>The general idea for all of these proofs is to apply <code>induction</code> to split the proof into smaller, simple cases.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">induction</span> b1<span style="color:#f92672">.</span>

<span style="color:#f92672">&lt;&lt;&lt;</span> 2 subgoals <span style="color:#f92672">(</span>ID 14<span style="color:#f92672">)</span>

  b2 <span style="color:#f92672">:</span> <span style="color:#66d9ef">bool</span>
  <span style="color:#f92672">============================</span>
  negb <span style="color:#f92672">(</span>true <span style="color:#f92672">&amp;&amp;</span> b2<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>negb true <span style="color:#f92672">||</span> negb b2<span style="color:#f92672">)%</span><span style="color:#66d9ef">bool</span>

subgoal 2 <span style="color:#f92672">(</span>ID 15<span style="color:#f92672">)</span> <span style="color:#66d9ef">is</span><span style="color:#f92672">:</span>
 negb <span style="color:#f92672">(</span>false <span style="color:#f92672">&amp;&amp;</span> b2<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>negb false <span style="color:#f92672">||</span> negb b2<span style="color:#f92672">)%</span><span style="color:#66d9ef">bool</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">auto</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">auto</span><span style="color:#f92672">.</span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">Theorem</span> problem4<span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> <span style="color:#f92672">(</span>C <span style="color:#f92672">:</span> <span style="color:#66d9ef">Prop</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>T <span style="color:#f92672">:</span> <span style="color:#f92672">Set</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>B <span style="color:#f92672">:</span> T <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Prop</span><span style="color:#f92672">),</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">exists</span> x <span style="color:#f92672">:</span> T<span style="color:#f92672">,</span> C <span style="color:#f92672">-&gt;</span> B x<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> C <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> x <span style="color:#f92672">:</span> T<span style="color:#f92672">,</span> B x<span style="color:#f92672">.</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intros</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 23<span style="color:#f92672">)</span>

  C <span style="color:#f92672">:</span> <span style="color:#66d9ef">Prop</span>
  T <span style="color:#f92672">:</span> <span style="color:#f92672">Set</span>
  B <span style="color:#f92672">:</span> T <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Prop</span>
  H <span style="color:#f92672">:</span> <span style="color:#66d9ef">exists</span> x <span style="color:#f92672">:</span> T<span style="color:#f92672">,</span> C <span style="color:#f92672">-&gt;</span> B x
  H0 <span style="color:#f92672">:</span> C
  <span style="color:#f92672">============================</span>
  <span style="color:#66d9ef">exists</span> x <span style="color:#f92672">:</span> T<span style="color:#f92672">,</span> B x

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">induction</span> H<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 30<span style="color:#f92672">)</span>

  C <span style="color:#f92672">:</span> <span style="color:#66d9ef">Prop</span>
  T <span style="color:#f92672">:</span> <span style="color:#f92672">Set</span>
  B <span style="color:#f92672">:</span> T <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Prop</span>
  x <span style="color:#f92672">:</span> T
  H <span style="color:#f92672">:</span> C <span style="color:#f92672">-&gt;</span> B x
  H0 <span style="color:#f92672">:</span> C
  <span style="color:#f92672">============================</span>
  <span style="color:#66d9ef">exists</span> x0 <span style="color:#f92672">:</span> T<span style="color:#f92672">,</span> B x0

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">apply</span> H <span style="color:#66d9ef">in</span> H0<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 31<span style="color:#f92672">)</span>

  C <span style="color:#f92672">:</span> <span style="color:#66d9ef">Prop</span>
  T <span style="color:#f92672">:</span> <span style="color:#f92672">Set</span>
  B <span style="color:#f92672">:</span> T <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Prop</span>
  x <span style="color:#f92672">:</span> T
  H <span style="color:#f92672">:</span> C <span style="color:#f92672">-&gt;</span> B x
  H0 <span style="color:#f92672">:</span> B x
  <span style="color:#f92672">============================</span>
  <span style="color:#66d9ef">exists</span> x0 <span style="color:#f92672">:</span> T<span style="color:#f92672">,</span> B x0

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">exists</span> x<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 34<span style="color:#f92672">)</span>

  C <span style="color:#f92672">:</span> <span style="color:#66d9ef">Prop</span>
  T <span style="color:#f92672">:</span> <span style="color:#f92672">Set</span>
  B <span style="color:#f92672">:</span> T <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">Prop</span>
  x <span style="color:#f92672">:</span> T
  H <span style="color:#f92672">:</span> C <span style="color:#f92672">-&gt;</span> B x
  H0 <span style="color:#f92672">:</span> B x
  <span style="color:#f92672">============================</span>
  B x

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">assumption</span><span style="color:#f92672">.</span></code></pre></div>
<p>Instead of explicitly using <code>apply H in H0.</code>, I've now discovered that the following simpler proof also works:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#66d9ef">intros</span><span style="color:#f92672">.</span>
<span style="color:#66d9ef">induction</span> H<span style="color:#f92672">.</span>
<span style="color:#66d9ef">exists</span> x<span style="color:#f92672">.</span>
<span style="color:#66d9ef">auto</span><span style="color:#f92672">.</span></code></pre></div>
<p>We have to deal with natural numbers for the final starter problem, which we can also solve using induction:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">Theorem</span> problem5<span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> m n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span> m <span style="color:#f92672">+</span> n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> m<span style="color:#f92672">.</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intros</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">induction</span> m<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 2 subgoals <span style="color:#f92672">(</span>ID 14<span style="color:#f92672">)</span>

  n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  <span style="color:#f92672">============================</span>
  0 <span style="color:#f92672">+</span> n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> 0

subgoal 2 <span style="color:#f92672">(</span>ID 18<span style="color:#f92672">)</span> <span style="color:#66d9ef">is</span><span style="color:#f92672">:</span>
 S m <span style="color:#f92672">+</span> n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> S m

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">auto</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 18<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  IHm <span style="color:#f92672">:</span> m <span style="color:#f92672">+</span> n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> m
  <span style="color:#f92672">============================</span>
  S m <span style="color:#f92672">+</span> n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> S m

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">simpl</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 21<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  IHm <span style="color:#f92672">:</span> m <span style="color:#f92672">+</span> n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> m
  <span style="color:#f92672">============================</span>
  S <span style="color:#f92672">(</span>m <span style="color:#f92672">+</span> n<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> S m

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">rewrite</span> IHm<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 22<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  IHm <span style="color:#f92672">:</span> m <span style="color:#f92672">+</span> n <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> m
  <span style="color:#f92672">============================</span>
  S <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> n <span style="color:#f92672">+</span> S m

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">auto</span><span style="color:#f92672">.</span></code></pre></div>
<p>There are only 2 more problems after the starter 6.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq">nice warmup<span style="color:#f92672">,</span> lets <span style="color:#66d9ef">do</span> some math<span style="color:#f92672">!</span>
<span style="color:#f92672">Require</span> <span style="color:#f92672">Import</span> Arith<span style="color:#f92672">.</span>Mult<span style="color:#f92672">.</span>
<span style="color:#f92672">Theorem</span> math_problem<span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> m n<span style="color:#f92672">,</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">*</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">=</span>  n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> 2 <span style="color:#f92672">*</span> n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m<span style="color:#f92672">.</span></code></pre></div>
<p>The idea with this one is simply to expand both sides, and let the theorem prover see that both sides have the same terms.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intros</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">simpl</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 13<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  <span style="color:#f92672">============================</span>
  <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">*</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> 0<span style="color:#f92672">))</span> <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">rewrite</span> mult_plus_distr_r<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">rewrite</span> mult_plus_distr_r<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 15<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  <span style="color:#f92672">============================</span>
  n <span style="color:#f92672">*</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">*</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">rewrite</span> mult_plus_distr_l<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">rewrite</span> mult_plus_distr_l<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 17<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  <span style="color:#f92672">============================</span>
  n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>m <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">*</span> m<span style="color:#f92672">)</span> <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">rewrite</span> plus_assoc<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">rewrite</span> plus_assoc<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 19<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  <span style="color:#f92672">============================</span>
  n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">+</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m

<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#66d9ef">rewrite</span> plus_0_r<span style="color:#f92672">.</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 20<span style="color:#f92672">)</span>

  m<span style="color:#f92672">,</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  <span style="color:#f92672">============================</span>
  n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m <span style="color:#f92672">=</span> n <span style="color:#f92672">*</span> n <span style="color:#f92672">+</span> n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> n <span style="color:#f92672">*</span> m <span style="color:#f92672">+</span> m <span style="color:#f92672">*</span> m
<span style="color:#f92672">&lt;&lt;&lt;</span> firstorder<span style="color:#f92672">.</span></code></pre></div>
<p><code>firstorder</code> didn't work on my machine but worked on the server Â¯\_(ãƒ„)_/Â¯</p>

<p>The final question took us a while:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq">gj<span style="color:#f92672">,</span> now something more interesting<span style="color:#f92672">,</span> can you prove my code works<span style="color:#f92672">?</span>

<span style="color:#f92672">Require</span> <span style="color:#f92672">Import</span> Le<span style="color:#f92672">.</span>
<span style="color:#f92672">Section</span> last_stage<span style="color:#f92672">.</span>
  <span style="color:#f92672">Variable</span> A <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span><span style="color:#f92672">.</span>

  <span style="color:#f92672">Inductive</span> <span style="color:#66d9ef">list</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span>  <span style="color:#f92672">:=</span>
   <span style="color:#f92672">|</span> nil <span style="color:#f92672">:</span> <span style="color:#66d9ef">list</span>
   <span style="color:#f92672">|</span> cons <span style="color:#f92672">:</span> A <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">list</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">list</span><span style="color:#f92672">.</span>


  <span style="color:#f92672">Fixpoint</span> nth <span style="color:#f92672">(</span>l <span style="color:#f92672">:</span> <span style="color:#66d9ef">list</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">)</span> <span style="color:#f92672">:</span> option A <span style="color:#f92672">:=</span>
    <span style="color:#66d9ef">match</span> n<span style="color:#f92672">,</span>l <span style="color:#66d9ef">with</span>
      <span style="color:#f92672">|</span> 0<span style="color:#f92672">,</span> cons x xs  <span style="color:#f92672">=&gt;</span> Some x
      <span style="color:#f92672">|</span> S n<span style="color:#f92672">,</span> cons <span style="color:#f92672">_</span> xs  <span style="color:#f92672">=&gt;</span> nth xs n
      <span style="color:#f92672">|</span> <span style="color:#f92672">_,</span> <span style="color:#f92672">_</span> <span style="color:#f92672">=&gt;</span> None
    <span style="color:#66d9ef">end</span><span style="color:#f92672">.</span>

  <span style="color:#f92672">Fixpoint</span> length <span style="color:#f92672">(</span>l<span style="color:#f92672">:</span><span style="color:#66d9ef">list</span><span style="color:#f92672">)</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span> <span style="color:#f92672">:=</span>
    <span style="color:#66d9ef">match</span> l <span style="color:#66d9ef">with</span>
      <span style="color:#f92672">|</span> nil <span style="color:#f92672">=&gt;</span> 0
      <span style="color:#f92672">|</span> cons <span style="color:#f92672">_</span> xs <span style="color:#f92672">=&gt;</span> 1 <span style="color:#f92672">+</span> length xs
    <span style="color:#66d9ef">end</span><span style="color:#f92672">.</span>

<span style="color:#f92672">Theorem</span> nth_in<span style="color:#f92672">:</span>  <span style="color:#66d9ef">forall</span> <span style="color:#f92672">(</span>n<span style="color:#f92672">:</span><span style="color:#66d9ef">nat</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>l<span style="color:#f92672">:</span><span style="color:#66d9ef">list</span><span style="color:#f92672">),</span> n <span style="color:#f92672">&lt;</span> length l <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a<span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth l n <span style="color:#f92672">=</span> Some a<span style="color:#f92672">.</span></code></pre></div>
<p>The idea for this is induction on both <code>n</code> and <code>l</code>. It should be easy for the base cases of <code>n</code> is <code>0</code>, or <code>l</code> is <code>nil</code>, and induction completes the rest of the proof.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-coq" data-lang="coq"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intros</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">revert</span> H<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">revert</span> n<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 15<span style="color:#f92672">)</span>

  A <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span>
  l <span style="color:#f92672">:</span> <span style="color:#66d9ef">list</span>
  <span style="color:#f92672">============================</span>
  <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span> n <span style="color:#f92672">&lt;</span> length l <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth l n <span style="color:#f92672">=</span> Some a

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">induction</span> l<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 2 subgoals <span style="color:#f92672">(</span>ID 19<span style="color:#f92672">)</span>

  A <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span>
  <span style="color:#f92672">============================</span>
  <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span> n <span style="color:#f92672">&lt;</span> length nil <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth nil n <span style="color:#f92672">=</span> Some a

subgoal 2 <span style="color:#f92672">(</span>ID 23<span style="color:#f92672">)</span> <span style="color:#66d9ef">is</span><span style="color:#f92672">:</span>
 <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span>
 n <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> n <span style="color:#f92672">=</span> Some a0

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">inversion</span> 1<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 23<span style="color:#f92672">)</span>

  A <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span>
  a <span style="color:#f92672">:</span> A
  l <span style="color:#f92672">:</span> <span style="color:#66d9ef">list</span>
  IHl <span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span> n <span style="color:#f92672">&lt;</span> length l <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth l n <span style="color:#f92672">=</span> Some a
  <span style="color:#f92672">============================</span>
  <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span>
  n <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> n <span style="color:#f92672">=</span> Some a0

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">induction</span> n<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 2 subgoals <span style="color:#f92672">(</span>ID 50<span style="color:#f92672">)</span>

  A <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span>
  a <span style="color:#f92672">:</span> A
  l <span style="color:#f92672">:</span> <span style="color:#66d9ef">list</span>
  IHl <span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span> n <span style="color:#f92672">&lt;</span> length l <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth l n <span style="color:#f92672">=</span> Some a
  <span style="color:#f92672">============================</span>
  0 <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> 0 <span style="color:#f92672">=</span> Some a0

subgoal 2 <span style="color:#f92672">(</span>ID 53<span style="color:#f92672">)</span> <span style="color:#66d9ef">is</span><span style="color:#f92672">:</span>
 S n <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>S n<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> Some a0

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">simpl</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 2 subgoals <span style="color:#f92672">(</span>ID 84<span style="color:#f92672">)</span>
  <span style="color:#f92672">...</span>
  0 <span style="color:#f92672">&lt;</span> S <span style="color:#f92672">(</span>length l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> Some a <span style="color:#f92672">=</span> Some a0
  <span style="color:#f92672">...</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">intro</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 2 subgoals <span style="color:#f92672">(</span>ID 60<span style="color:#f92672">)</span>
  <span style="color:#f92672">...</span>
  <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> Some a <span style="color:#f92672">=</span> Some a0
  <span style="color:#f92672">...</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">exists</span> a<span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> <span style="color:#f92672">...</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">auto</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 53<span style="color:#f92672">)</span>

  A <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span>
  a <span style="color:#f92672">:</span> A
  l <span style="color:#f92672">:</span> <span style="color:#66d9ef">list</span>
  IHl <span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span> n <span style="color:#f92672">&lt;</span> length l <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth l n <span style="color:#f92672">=</span> Some a
  n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  IHn <span style="color:#f92672">:</span> n <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> n <span style="color:#f92672">=</span> Some a0
  <span style="color:#f92672">============================</span>
  S n <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>S n<span style="color:#f92672">)</span> <span style="color:#f92672">=</span> Some a0

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">simpl</span><span style="color:#f92672">.</span>
<span style="color:#f92672">&lt;&lt;&lt;</span> 1 subgoal <span style="color:#f92672">(</span>ID 68<span style="color:#f92672">)</span>

  A <span style="color:#f92672">:</span> <span style="color:#66d9ef">Type</span>
  a <span style="color:#f92672">:</span> A
  l <span style="color:#f92672">:</span> <span style="color:#66d9ef">list</span>
  IHl <span style="color:#f92672">:</span> <span style="color:#66d9ef">forall</span> n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span><span style="color:#f92672">,</span> n <span style="color:#f92672">&lt;</span> length l <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth l n <span style="color:#f92672">=</span> Some a
  n <span style="color:#f92672">:</span> <span style="color:#66d9ef">nat</span>
  IHn <span style="color:#f92672">:</span> n <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth <span style="color:#f92672">(</span>cons a l<span style="color:#f92672">)</span> n <span style="color:#f92672">=</span> Some a0
  <span style="color:#f92672">============================</span>
  S n <span style="color:#f92672">&lt;</span> S <span style="color:#f92672">(</span>length l<span style="color:#f92672">)</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">exists</span> a0 <span style="color:#f92672">:</span> A<span style="color:#f92672">,</span> nth l n <span style="color:#f92672">=</span> Some a0

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">auto</span> <span style="color:#66d9ef">with</span> arith<span style="color:#f92672">.</span></code></pre></div>
<p>Finally we have the flag:</p>

<p><code>gj flag: DrgnS{xxxx_my_c0q_for_4_flag_17bcbc34b7c565a766e335}</code></p>

</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://b6a.black/tags/ctf/">ctf</a></li>
      <li><a href="https://b6a.black/tags/dragonctf/">dragonctf</a></li>
      <li><a href="https://b6a.black/tags/crypto/">crypto</a></li>
    </ul>
    <nav class="paginav">
      <a class="prev" href="https://b6a.black/posts/2020-12-20-hxpctf-hyper/">
        <span class="title">Â« Prev Page</span>
        <br>
        <span>hxp CTF 2020: Hyper</span>
      </a>
      <a class="next" href="https://b6a.black/posts/2020-09-23-twctf/">
        <span class="title">Next Page Â»</span>
        <br>
        <span>TokyoWesterns CTF 6th 2020 Writeup</span>
      </a>
    </nav>
  </footer>
</article>
<aside class="toc-container">
  <a href="#" style="text-decoration: none; font-weight: 700;">
    Dragon CTF 2020 Writeup
  </a>
  <div class="js-toc"></div>
</aside>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.css" integrity="sha512-SFw7k74K3983tyOlJIHa8atr9Ppef3Kix5cmifwzU7ZdtU2E0FRuOVRtd3ENpMJ8sNCie5hlb/0j23efcdQJXA==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.12.0/tocbot.min.js" integrity="sha512-oD3xGN8YTxenx6tdS4D/RKqO4OtORBQtAb2/FseM17GGMIi6jMwKUBc8duX4A5RwMOGGXoFBZrsqbOk8GpXFgQ==" crossorigin="anonymous"></script>

<script type="text/javascript">
  tocbot.init({
    headingSelector: 'h1, h2, h3, h4',
    orderedList: false,
    headingLabelCallback: s => s.substr(0, s.length-1),
    collapseDepth: 2
  });
</script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/viz.js/1.7.1/viz.js"> </script>
<script type="text/javascript">
  (function () {
    const vizPrefix = "language-viz-";
    Array.prototype.forEach.call(document.querySelectorAll("[class^=" + vizPrefix + "]"), function (x) {
      let engine;
      x.getAttribute("class").split(" ").forEach(function (cls) {
        if (cls.startsWith(vizPrefix)) {
          engine = cls.substr(vizPrefix.length);
        }
      });
      const image = new DOMParser().parseFromString(Viz(x.innerText, { format: "svg", engine: engine }), "image/svg+xml");
      x.parentNode.insertBefore(image.documentElement, x);
      x.style.display = 'none'
      x.parentNode.style.backgroundColor = "white"
    });
  })();
</script>
    </main><footer class="footer">
    <span>&copy; 2025 <a href="https://b6a.black/">Black Bauhinia</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
  onload="renderMathInElement(document.body, { delimiters: [{ left: '$$', right: '$$', display: true }, { left: '\\[', right: '\\]', display: true }, { left: '$', right: '$', display: false }, { left: '\\(', right: '\\)', display: false }]})"></script>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>
mermaid.initialize({
    startOnLoad: true,
    htmlLabels: true,
    securityLevel: "loose",
    theme: 'base',
    themeVariables: {
        background: '#22222c',
        primaryColor: '#33333c',
        primaryTextColor: '#ffe4e1',
    }
});
</script>



<script defer src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>

</body>

</html>
